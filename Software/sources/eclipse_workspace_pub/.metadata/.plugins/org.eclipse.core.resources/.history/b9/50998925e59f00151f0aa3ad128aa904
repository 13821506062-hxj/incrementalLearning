# This is a make file for OMCBoost package
# Amir Saffari, amir@ymer.org
#-----------------------------------------

# Compiler options
CC = g++

HOST=$(shell hostname)
INCLUDEPATH = -I/usr/local/include -I$(HOME)/local/include -I$(ONLINE_LEARNING_DIR)/Software/sources/eigen/install/include/eigen2 -I$(ONLINE_LEARNING_STORAGE_DIR)/libs/libconfig/$(HOST)/include

LINKPATH = -L/usr/local/lib -L$(HOME)/local/lib -L$(ONLINE_LEARNING_STORAGE_DIR)/libs/libconfig/$(HOST)/lib

# OPTIMIZED
CFLAGS = -c -O3 -Wall -march=native -DNDEBUG -mtune=native -Wno-deprecated
LDFLAGS = -shared -lconfig++ 

# Source directory and files
SOURCEDIR = src
HEADERS := $(wildcard $(SOURCEDIR)/*.h)
SOURCES := $(wildcard $(SOURCEDIR)/*.cpp)
OBJECTS := $(SOURCES:.cpp=.o)
LIBLARANKDIR := $(SOURCEDIR)/linear_larank

# Target output
BUILDTARGET = orf.so
tmp:
	@echo $(LINKPATH)
	@echo $(INCLUDEPATH)

# Build
all: $(BUILDTARGET)
$(BUILDTARGET): $(OBJECTS) $(SOURCES) $(HEADERS) $(LIBLARANKDIR)/LaRank.o $(LIBLARANKDIR)/vectors.o 
	$(CC) $(OBJECTS)  $(LINKPATH) $(LDFLAGS) $(LIBLARANKDIR)/LaRank.o $(LIBLARANKDIR)/vectors.o -o $@

.cpp.o:
	$(CC) $(CFLAGS) $(INCLUDEPATH) $< -o $@

$(LIBLARANKDIR)/LaRank.o: $(LIBLARANKDIR)/LaRank.cpp  $(LIBLARANKDIR)/LaRank.h $(LIBLARANKDIR)/vectors.o
	$(CC) $(CFLAGS) $(INCLUDEPATH) -o $(LIBLARANKDIR)/LaRank.o $(LIBLARANKDIR)/LaRank.cpp

$(LIBLARANKDIR)/vectors.o: $(LIBLARANKDIR)/vectors.h $(LIBLARANKDIR)/wrapper.h
	$(CC) $(CFLAGS) $(INCLUDEPATH) -o $(LIBLARANKDIR)/vectors.o $(LIBLARANKDIR)/vectors.cpp

clean:
	rm -f $(SOURCEDIR)/*~ $(SOURCEDIR)/*.o
	rm -f $(LIBLARANKDIR)/*.o
	rm -f $(BUILDTARGET)
